<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEGIS Scheduler Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .header .update-time {
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #999;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .jobs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .jobs-table thead {
            background: #f8f9fa;
        }

        .jobs-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .jobs-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }

        .jobs-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-stale {
            background: #e2e3e5;
            color: #383d41;
        }

        .priority-high {
            color: #dc3545;
            font-weight: 600;
        }

        .priority-medium {
            color: #ffc107;
            font-weight: 600;
        }

        .priority-low {
            color: #6c757d;
            font-weight: 600;
        }

        .model-badge {
            display: inline-block;
            padding: 3px 8px;
            margin: 2px;
            border-radius: 8px;
            font-size: 0.75rem;
            background: #e3f2fd;
            color: #1976d2;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-controls label {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
        }

        .filter-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        .filter-controls select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š AEGIS Scheduler Dashboard</h1>
            <div class="subtitle">ì‹¤ì‹œê°„ ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ì—… ëª¨ë‹ˆí„°ë§</div>
            <div class="update-time">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-12-03 21:12:30</div>
        </div>

        <!-- ìš”ì•½ í†µê³„ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Recovery Queue</h3>
                <div class="stat-value">0</div>
                <div class="stat-label">ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
                <div style="margin-top: 5px; font-size: 0.8rem; color: #666;">
                    ì„±ê³µë¥ : 0.0% (0/0)
                </div>
            </div>

            <div class="stat-card">
                <h3>Gemini API (Today)</h3>
                <div class="stat-value">204</div>
                <div class="stat-label">ìš”ì²­ ìˆ˜ / 1500 ì œí•œ</div>
                <div class="progress-bar">
                    <div class="progress-fill "
                         style="width: 13.600000000000001%"></div>
                </div>
                <div style="margin-top: 5px; font-size: 0.8rem; color: #666;">
                    ì‚¬ìš©ë¥ : 13.6%
                </div>
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #f0f0f0;">
                    <div style="font-size: 0.75rem; color: #999; margin-bottom: 5px;">ëª¨ë¸ë³„ ì‚¬ìš©ëŸ‰:</div>
                    <span class="model-badge">gemini-3-pro-preview: 7</span><span class="model-badge">gemini-2.0-flash: 197</span>
                </div>
            </div>

            <div class="stat-card">
                <h3>Gemini API (Last Hour)</h3>
                <div class="stat-value">0</div>
                <div class="stat-label">ìµœê·¼ 1ì‹œê°„ ìš”ì²­</div>
                <div class="progress-bar">
                    <div class="progress-fill "
                         style="width: 0.0%"></div>
                </div>
                <div style="margin-top: 5px; font-size: 0.8rem; color: #666;">
                    RPM ì‚¬ìš©ë¥ : 0.0%
                </div>
            </div>

            <div class="stat-card">
                <h3>This Month</h3>
                <div class="stat-value">529</div>
                <div class="stat-label">ì´ë²ˆ ë‹¬ ì´ ìš”ì²­</div>
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #f0f0f0;">
                    <div style="font-size: 0.75rem; color: #999; margin-bottom: 5px;">ëª¨ë¸ë³„ ì‚¬ìš©ëŸ‰:</div>
                    <span class="model-badge">gemini-2.0-flash + gemini-2.0-flash: 2</span><span class="model-badge">gemini-3-pro-preview: 16</span><span class="model-badge">gemini-2.0-flash: 510</span><span class="model-badge">error: 1</span>
                </div>
            </div>
        </div>

        <!-- Cron ì‘ì—… ìƒíƒœ -->
        <div class="section">
            <h2 class="section-title">â° Cron ì‘ì—… ìƒíƒœ</h2>

            <!-- í•„í„° ì»¨íŠ¸ë¡¤ -->
            <div class="filter-controls">
                <label for="modelFilter">ğŸ” Gemini ëª¨ë¸ í•„í„°:</label>
                <select id="modelFilter">
                    <option value="all">ì „ì²´ ë³´ê¸°</option>
                    <option value="error">error</option><option value="gemini-2.0-flash">gemini-2.0-flash</option><option value="gemini-2.0-flash + gemini-2.0-flash">gemini-2.0-flash + gemini-2.0-flash</option><option value="gemini-3-pro-preview">gemini-3-pro-preview</option>
                </select>
            </div>

            <table class="jobs-table">
                <thead>
                    <tr>
                        <th style="width: 80px;">ì‹¤í–‰</th>
                        <th>ì‘ì—…ëª…</th>
                        <th>Gemini ëª¨ë¸</th>
                        <th>ì£¼ê¸°</th>
                        <th>ìŠ¤ì¼€ì¤„</th>
                        <th>ë§ˆì§€ë§‰ ì‹¤í–‰</th>
                        <th>ìƒíƒœ</th>
                        <th>24ì‹œê°„ í†µê³„</th>
                        <th>ìš°ì„ ìˆœìœ„</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">

                    <tr data-model="gemini-1.5-flash">
                        <td>
                            <button class="run-btn" data-job-id="kb_dashboard" data-job-name="KB Dashboard"
                                onclick="runJob('kb_dashboard', 'KB Dashboard')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>KB Dashboard</strong></td>
                        <td>
                <select class="model-selector" data-job-id="generate_realtime_dashboard" style="
                    padding: 4px 8px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    background: white;
                    font-size: 0.8rem;
                    cursor: pointer;
                "><option value="gemini-1.5-flash" selected>gemini-1.5-flash</option><option value="gemini-1.5-pro" >gemini-1.5-pro</option><option value="gemini-2.0-flash" >gemini-2.0-flash</option><option value="gemini-2.0-flash-exp" >gemini-2.0-flash-exp</option><option value="gemini-3-pro-preview" >gemini-3-pro-preview</option></select></td>
                        <td>1ë¶„</td>
                        <td>08:50-15:30</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-high">HIGH</td>
                    </tr>

                    <tr data-model="gemini-1.5-flash">
                        <td>
                            <button class="run-btn" data-job-id="kis_dashboard" data-job-name="KIS Dashboard"
                                onclick="runJob('kis_dashboard', 'KIS Dashboard')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>KIS Dashboard</strong></td>
                        <td>
                <select class="model-selector" data-job-id="kis_dashboard" style="
                    padding: 4px 8px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    background: white;
                    font-size: 0.8rem;
                    cursor: pointer;
                "><option value="gemini-1.5-flash" selected>gemini-1.5-flash</option><option value="gemini-1.5-pro" >gemini-1.5-pro</option><option value="gemini-2.0-flash" >gemini-2.0-flash</option><option value="gemini-2.0-flash-exp" >gemini-2.0-flash-exp</option><option value="gemini-3-pro-preview" >gemini-3-pro-preview</option></select></td>
                        <td>10ë¶„</td>
                        <td>08:55-15:35</td>
                        <td>12-03 15:50</td>
                        <td><span class="status-badge status-warning">ì§€ì—°</span></td>
                        <td>âœ… 25 / âŒ 0</td>
                        <td class="priority-high">HIGH</td>
                    </tr>

                    <tr data-model="none">
                        <td>
                            <button class="run-btn" data-job-id="recovery_worker" data-job-name="Recovery Worker"
                                onclick="runJob('recovery_worker', 'Recovery Worker')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>Recovery Worker</strong></td>
                        <td><span style="color: #999; font-size: 0.8rem;">-</span></td>
                        <td>10ë¶„</td>
                        <td>24ì‹œê°„</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-high">HIGH</td>
                    </tr>

                    <tr data-model="none">
                        <td>
                            <button class="run-btn" data-job-id="dashboard_email" data-job-name="Dashboard Email"
                                onclick="runJob('dashboard_email', 'Dashboard Email')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>Dashboard Email</strong></td>
                        <td><span style="color: #999; font-size: 0.8rem;">-</span></td>
                        <td>20ë¶„</td>
                        <td>08:50-15:30</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-medium">MEDIUM</td>
                    </tr>

                    <tr data-model="gemini-1.5-flash">
                        <td>
                            <button class="run-btn" data-job-id="data_fetch" data-job-name="Data Fetch"
                                onclick="runJob('data_fetch', 'Data Fetch')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>Data Fetch</strong></td>
                        <td>
                <select class="model-selector" data-job-id="data_fetch" style="
                    padding: 4px 8px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    background: white;
                    font-size: 0.8rem;
                    cursor: pointer;
                "><option value="gemini-1.5-flash" selected>gemini-1.5-flash</option><option value="gemini-1.5-pro" >gemini-1.5-pro</option><option value="gemini-2.0-flash" >gemini-2.0-flash</option><option value="gemini-2.0-flash-exp" >gemini-2.0-flash-exp</option></select></td>
                        <td>30ë¶„</td>
                        <td>24ì‹œê°„</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-high">HIGH</td>
                    </tr>

                    <tr data-model="none">
                        <td>
                            <button class="run-btn" data-job-id="aegis_sync" data-job-name="AEGIS Sync"
                                onclick="runJob('aegis_sync', 'AEGIS Sync')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>AEGIS Sync</strong></td>
                        <td><span style="color: #999; font-size: 0.8rem;">-</span></td>
                        <td>30ë¶„</td>
                        <td>24ì‹œê°„</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-low">LOW</td>
                    </tr>

                    <tr data-model="gemini-2.0-flash-exp">
                        <td>
                            <button class="run-btn" data-job-id="new_stock" data-job-name="New Stock"
                                onclick="runJob('new_stock', 'New Stock')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>New Stock</strong></td>
                        <td>
                <select class="model-selector" data-job-id="new_stock" style="
                    padding: 4px 8px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    background: white;
                    font-size: 0.8rem;
                    cursor: pointer;
                "><option value="gemini-1.5-flash" >gemini-1.5-flash</option><option value="gemini-1.5-pro" >gemini-1.5-pro</option><option value="gemini-2.0-flash" >gemini-2.0-flash</option><option value="gemini-2.0-flash-exp" selected>gemini-2.0-flash-exp</option><option value="gemini-3-pro-preview" >gemini-3-pro-preview</option></select></td>
                        <td>3ì‹œê°„</td>
                        <td>08:00-15:00</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-medium">MEDIUM</td>
                    </tr>

                    <tr data-model="none">
                        <td>
                            <button class="run-btn" data-job-id="eod_settlement" data-job-name="EOD Settlement"
                                onclick="runJob('eod_settlement', 'EOD Settlement')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>EOD Settlement</strong></td>
                        <td><span style="color: #999; font-size: 0.8rem;">-</span></td>
                        <td>ì¼ 1íšŒ</td>
                        <td>18:00</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-high">HIGH</td>
                    </tr>

                    <tr data-model="none">
                        <td>
                            <button class="run-btn" data-job-id="scheduler_dashboard" data-job-name="Scheduler Dashboard"
                                onclick="runJob('scheduler_dashboard', 'Scheduler Dashboard')"
                                style="
                                    padding: 6px 12px;
                                    border: none;
                                    border-radius: 6px;
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    cursor: pointer;
                                    font-size: 0.8rem;
                                    font-weight: 600;
                                    transition: all 0.2s;
                                "
                                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 8px rgba(102, 126, 234, 0.3)'"
                                onmouseout="this.style.transform=''; this.style.boxShadow=''">
                                â–¶ ì‹¤í–‰
                            </button>
                        </td>
                        <td><strong>Scheduler Dashboard</strong></td>
                        <td><span style="color: #999; font-size: 0.8rem;">-</span></td>
                        <td>10ë¶„</td>
                        <td>24ì‹œê°„</td>
                        <td>-</td>
                        <td><span class="status-badge status-stale">ë¡œê·¸ ì—†ìŒ</span></td>
                        <td>âœ… 0 / âŒ 0</td>
                        <td class="priority-medium">MEDIUM</td>
                    </tr>

                </tbody>
            </table>
        </div>

        <!-- Recovery Queue ìƒì„¸ -->
        <div class="section">
            <h2 class="section-title">ğŸ”„ Recovery Queue ìƒì„¸</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Pending</h3>
                    <div class="stat-value" style="color: #ffc107;">0</div>
                    <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                </div>
                <div class="stat-card">
                    <h3>Completed</h3>
                    <div class="stat-value" style="color: #28a745;">0</div>
                    <div class="stat-label">ì™„ë£Œ</div>
                </div>
                <div class="stat-card">
                    <h3>Failed</h3>
                    <div class="stat-value" style="color: #dc3545;">0</div>
                    <div class="stat-label">ì‹¤íŒ¨</div>
                </div>
                <div class="stat-card">
                    <h3>Success Rate</h3>
                    <div class="stat-value">0.0%</div>
                    <div class="stat-label">ì„±ê³µë¥  (24ì‹œê°„)</div>
                </div>
            </div>
        </div>

        <div class="footer">
            Generated by AEGIS System | Phase 39 | Auto-refresh every 10 minutes
        </div>
    </div>

    <script>
        // API ì„œë²„ ì£¼ì†Œ
        const API_BASE_URL = 'http://localhost:5555';

        // ì‘ì—… ì‹¤í–‰ í•¨ìˆ˜
        async function runJob(jobId, jobName) {
            const button = event.target;
            const originalHTML = button.innerHTML;

            try {
                // ë²„íŠ¼ ë¹„í™œì„±í™”
                button.disabled = true;
                button.innerHTML = 'â³ ì‹¤í–‰ ì¤‘...';
                button.style.opacity = '0.6';
                button.style.cursor = 'not-allowed';

                // API í˜¸ì¶œ
                const response = await fetch(`${API_BASE_URL}/run/${jobId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // ì„±ê³µ ì•Œë¦¼
                    showNotification(`âœ… ${jobName} ì‹¤í–‰ ì‹œì‘`, `Task ID: ${data.task_id}`, 'success');

                    // ìƒíƒœ ëª¨ë‹ˆí„°ë§
                    monitorTask(data.task_id, jobName);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }

            } catch (error) {
                console.error('Error running job:', error);

                // API ì„œë²„ ì—°ê²° í™•ì¸
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    showNotification(
                        'âŒ API ì„œë²„ ë¯¸ì‹¤í–‰',
                        `Scheduler APIê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\ní„°ë¯¸ë„ì—ì„œ ì‹¤í–‰:\npython scripts/scheduler_api.py`,
                        'error',
                        8000
                    );
                } else {
                    showNotification(`âŒ ì‹¤í–‰ ì‹¤íŒ¨`, error.message, 'error');
                }

                // ë²„íŠ¼ ì›ë³µ
                button.disabled = false;
                button.innerHTML = originalHTML;
                button.style.opacity = '';
                button.style.cursor = '';
            }
        }

        // ì‘ì—… ìƒíƒœ ëª¨ë‹ˆí„°ë§
        async function monitorTask(taskId, jobName) {
            let attempts = 0;
            const maxAttempts = 60; // 5ë¶„ (5ì´ˆ ê°„ê²©)

            const interval = setInterval(async () => {
                attempts++;

                try {
                    const response = await fetch(`${API_BASE_URL}/status/${taskId}`);
                    const data = await response.json();

                    if (data.success && data.task) {
                        const status = data.task.status;

                        if (status === 'completed') {
                            clearInterval(interval);
                            showNotification(
                                `âœ… ${jobName} ì™„ë£Œ`,
                                `ì‹¤í–‰ ì‹œê°„: ${calculateDuration(data.task.started_at, data.task.completed_at)}`,
                                'success'
                            );
                            // 1ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                            setTimeout(() => location.reload(), 1000);

                        } else if (status === 'failed') {
                            clearInterval(interval);
                            showNotification(
                                `âŒ ${jobName} ì‹¤íŒ¨`,
                                data.task.error || 'Unknown error',
                                'error',
                                8000
                            );

                        } else if (status === 'timeout') {
                            clearInterval(interval);
                            showNotification(
                                `â±ï¸ ${jobName} íƒ€ì„ì•„ì›ƒ`,
                                'ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ (5ë¶„)',
                                'warning',
                                5000
                            );
                        }
                    }
                } catch (error) {
                    console.error('Error monitoring task:', error);
                }

                // ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼
                if (attempts >= maxAttempts) {
                    clearInterval(interval);
                    showNotification(
                        `â±ï¸ ${jobName} ëª¨ë‹ˆí„°ë§ íƒ€ì„ì•„ì›ƒ`,
                        'ìƒíƒœ í™•ì¸ ì‹œê°„ ì´ˆê³¼',
                        'warning'
                    );
                }
            }, 5000); // 5ì´ˆë§ˆë‹¤ í™•ì¸
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(title, message, type = 'info', duration = 5000) {
            const colors = {
                success: { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', text: 'white' },
                error: { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', text: 'white' },
                warning: { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', text: 'white' },
                info: { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', text: 'white' }
            };

            const color = colors[type] || colors.info;

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: ${color.text};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-size: 0.9rem;
                max-width: 400px;
                white-space: pre-line;
            `;
            notification.innerHTML = `
                <strong>${title}</strong><br>
                <span style="font-size: 0.85rem; opacity: 0.9;">${message}</span>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, duration);
        }

        // ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
        function calculateDuration(startTime, endTime) {
            const start = new Date(startTime);
            const end = new Date(endTime);
            const diff = Math.round((end - start) / 1000); // ì´ˆ ë‹¨ìœ„
            if (diff < 60) return `${diff}ì´ˆ`;
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;
            return `${minutes}ë¶„ ${seconds}ì´ˆ`;
        }

        // 10ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
            location.reload();
        }, 10 * 60 * 1000);

        // Gemini ëª¨ë¸ í•„í„°ë§
        document.addEventListener('DOMContentLoaded', function() {
            const modelFilter = document.getElementById('modelFilter');
            const jobsTableBody = document.getElementById('jobsTableBody');

            // ëª¨ë¸ í•„í„°ë§ ê¸°ëŠ¥
            if (modelFilter && jobsTableBody) {
                modelFilter.addEventListener('change', function() {
                    const selectedModel = this.value;
                    const rows = jobsTableBody.getElementsByTagName('tr');

                    for (let i = 0; i < rows.length; i++) {
                        const row = rows[i];
                        const rowModel = row.getAttribute('data-model');

                        if (selectedModel === 'all') {
                            row.style.display = '';
                        } else if (rowModel === selectedModel) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                });
            }

            // ëª¨ë¸ ì„ íƒê¸° ë³€ê²½ ì´ë²¤íŠ¸
            const modelSelectors = document.querySelectorAll('.model-selector');
            modelSelectors.forEach(selector => {
                selector.addEventListener('change', function() {
                    const jobId = this.getAttribute('data-job-id');
                    const newModel = this.value;

                    // localStorageì— ì €ì¥
                    const config = JSON.parse(localStorage.getItem('scheduler_models') || '{}');
                    config[jobId] = newModel;
                    config.updated_at = new Date().toISOString();
                    localStorage.setItem('scheduler_models', JSON.stringify(config));

                    // ì‹œê°ì  í”¼ë“œë°±
                    this.style.borderColor = '#667eea';
                    this.style.backgroundColor = '#f0f4ff';

                    // ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
                    const message = document.createElement('div');
                    message.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 15px 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                        z-index: 10000;
                        font-size: 0.9rem;
                        max-width: 400px;
                    `;
                    message.innerHTML = `
                        <strong>âœ… ëª¨ë¸ ë³€ê²½ ì €ì¥ë¨</strong><br>
                        <span style="font-size: 0.85rem; opacity: 0.9;">
                        ${jobId}: ${newModel}<br>
                        ì„¤ì • íŒŒì¼ ì—…ë°ì´íŠ¸: <code style="background: rgba(255,255,255,0.2); padding: 2px 4px; border-radius: 3px;">python scripts/update_scheduler_models.py</code>
                        </span>
                    `;
                    document.body.appendChild(message);

                    // 3ì´ˆ í›„ ë©”ì‹œì§€ ì œê±°
                    setTimeout(() => {
                        message.style.opacity = '0';
                        message.style.transition = 'opacity 0.5s';
                        setTimeout(() => message.remove(), 500);
                    }, 3000);

                    // ìŠ¤íƒ€ì¼ ì›ë³µ
                    setTimeout(() => {
                        this.style.borderColor = '#ddd';
                        this.style.backgroundColor = 'white';
                    }, 1000);
                });
            });

            // localStorageì—ì„œ ì €ì¥ëœ ì„¤ì • ë¡œë“œ
            const savedConfig = JSON.parse(localStorage.getItem('scheduler_models') || '{}');
            modelSelectors.forEach(selector => {
                const jobId = selector.getAttribute('data-job-id');
                if (savedConfig[jobId]) {
                    selector.value = savedConfig[jobId];
                }
            });
        });
    </script>
</body>
</html>
